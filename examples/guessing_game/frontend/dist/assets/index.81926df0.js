const O=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const t of s)if(t.type==="childList")for(const o of t.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function i(s){const t={};return s.integrity&&(t.integrity=s.integrity),s.referrerpolicy&&(t.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?t.credentials="include":s.crossorigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function n(s){if(s.ep)return;s.ep=!0;const t=i(s);fetch(s.href,t)}};O();var w=globalThis&&globalThis.__awaiter||function(r,e,i,n){function s(t){return t instanceof i?t:new i(function(o){o(t)})}return new(i||(i=Promise))(function(t,o){function a(u){try{h(n.next(u))}catch(m){o(m)}}function c(u){try{h(n.throw(u))}catch(m){o(m)}}function h(u){u.done?t(u.value):s(u.value).then(a,c)}h((n=n.apply(r,e||[])).next())})},d;(function(r){r[r.Set=1]="Set",r[r.Emit=2]="Emit",r[r.Get=3]="Get",r[r.Error=4]="Error"})(d||(d={}));var f;(function(r){r[r.Up=0]="Up",r[r.Down=1]="Down"})(f||(f={}));class S{constructor(e){this.addr=e,this.raw={},this.work_pool=[],this.get_queue={},this.state=f.Down,this.identifier=Symbol(),l[this.identifier]={}}connect(){return w(this,void 0,void 0,function*(){let e=this;new Promise(i=>{var n;(n=e.ws)===null||n===void 0||n.close(),e.ws=new WebSocket("ws://"+this.addr),e.ws.onopen=()=>{e.state=f.Up,e.ws.onmessage=s=>{var t,o;const a=JSON.parse(s.data);switch(a.message_type){case d.Get:this.get_queue[a.key].length>0&&((t=this.get_queue[a.key].shift())===null||t===void 0||t(a.data));break;case d.Set:this.raw[a.key]=JSON.parse(a.data),(o=l[this.identifier][a.key])===null||o===void 0||o.forEach(c=>c());break;default:console.log("Unimplemented message: "+a)}},e.work_pool.forEach(s=>{let t={message_type:d.Get,key:s};e.ws.send(JSON.stringify(t))}),e.work_pool=[],i(void 0)}})})}close(){var e;(e=this.ws)===null||e===void 0||e.close(),this.state=f.Down}get_data(e){var i;return w(this,void 0,void 0,function*(){const n={message_type:d.Get,key:e};return this.state==f.Up?(i=this.ws)===null||i===void 0||i.send(JSON.stringify(n)):this.work_pool.push(e),new Promise(s=>{this.get_queue[e]=this.get_queue[e]||[],this.get_queue[e].push(s)})})}set_data(e,i){var n;return w(this,void 0,void 0,function*(){const s={message_type:d.Set,key:e,data:i};(n=this.ws)===null||n===void 0||n.send(JSON.stringify(s))})}reactive(e){return w(this,void 0,void 0,function*(){const i=this,n=yield this.get_data(e),s=JSON.parse(JSON.parse(n));return new Promise(t=>{i.raw[e]=s,l[i.identifier][e]=[];const o=new Proxy(s,{get(a,c){return v&&l[i.identifier][e].push(p),i.raw[e][c]},set(a,c,h){return a[c]=h,i.set_data(e,JSON.stringify(a)),l[i.identifier][e].forEach(u=>u()),!0}});t(o)})})}reactive_with_default(e,i){const n=this;return n.set_data(e,JSON.stringify(i)),n.raw[e]=i,l[n.identifier][e]=[],new Proxy(i,{get(t,o){return v&&l[n.identifier][e].push(p),t[o]},set(t,o,a){return t[o]=a,n.set_data(e,JSON.stringify(t)),l[n.identifier][e].forEach(c=>c()),!0}})}emit(e){var i;const n={message_type:d.Emit,key:e};(i=this.ws)===null||i===void 0||i.send(JSON.stringify(n))}}let v=!1,p=()=>{},l={};function N(r){v=!0,p=r,r(),v=!1}const _=new S("localhost:2341");await _.connect();const E=await _.reactive("guess"),g=await _.reactive("answer"),y=document.querySelector("#input");y.addEventListener("input",()=>{E.guess=y.value});const b=document.querySelector("#close");b.addEventListener("click",()=>{_.emit("close")});N(()=>{const r=document.querySelector("#result");console.log(g.answer),r.innerHTML=g.answer});
