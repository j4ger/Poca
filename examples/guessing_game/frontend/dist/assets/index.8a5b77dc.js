const O=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const e of i)if(e.type==="childList")for(const o of e.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function r(i){const e={};return i.integrity&&(e.integrity=i.integrity),i.referrerpolicy&&(e.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?e.credentials="include":i.crossorigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function s(i){if(i.ep)return;i.ep=!0;const e=r(i);fetch(i.href,e)}};O();var w=globalThis&&globalThis.__awaiter||function(n,t,r,s){function i(e){return e instanceof r?e:new r(function(o){o(e)})}return new(r||(r=Promise))(function(e,o){function a(u){try{h(s.next(u))}catch(p){o(p)}}function c(u){try{h(s.throw(u))}catch(p){o(p)}}function h(u){u.done?e(u.value):i(u.value).then(a,c)}h((s=s.apply(n,t||[])).next())})},d;(function(n){n[n.Set=1]="Set",n[n.Emit=2]="Emit",n[n.Get=3]="Get",n[n.Error=4]="Error"})(d||(d={}));var f;(function(n){n[n.Up=0]="Up",n[n.Down=1]="Down"})(f||(f={}));class S{constructor(t){this.addr=t,this.raw={},this.work_pool=[],this.get_queue={},this.state=f.Down,this.identifier=Symbol(),l[this.identifier]={}}connect(){return w(this,void 0,void 0,function*(){let t=this;new Promise(r=>{var s;(s=t.ws)===null||s===void 0||s.close(),t.ws=new WebSocket("ws://"+this.addr),t.ws.onopen=()=>{t.state=f.Up,t.ws.onmessage=i=>{var e,o;const a=JSON.parse(i.data);switch(a.message_type){case d.Get:this.get_queue[a.key].length>0&&((e=this.get_queue[a.key].shift())===null||e===void 0||e(a.data));break;case d.Set:this.raw[a.key]=JSON.parse(a.data),(o=l[this.identifier][a.key])===null||o===void 0||o.forEach(c=>c());break;default:console.log(a)}},t.work_pool.forEach(i=>{let e={message_type:d.Get,key:i};t.ws.send(JSON.stringify(e))}),t.work_pool=[],r(void 0)}})})}close(){var t;(t=this.ws)===null||t===void 0||t.close(),this.state=f.Down}get_data(t){var r;return w(this,void 0,void 0,function*(){const s={message_type:d.Get,key:t};return this.state==f.Up?(r=this.ws)===null||r===void 0||r.send(JSON.stringify(s)):this.work_pool.push(t),new Promise(i=>{this.get_queue[t]=this.get_queue[t]||[],this.get_queue[t].push(i)})})}set_data(t,r){var s;return w(this,void 0,void 0,function*(){const i={message_type:d.Set,key:t,data:r};(s=this.ws)===null||s===void 0||s.send(JSON.stringify(i))})}reactive(t){return w(this,void 0,void 0,function*(){const r=this,s=yield this.get_data(t),i=JSON.parse(JSON.parse(s));return new Promise(e=>{r.raw[t]=i,l[r.identifier][t]=[];const o=new Proxy(i,{get(a,c){return v&&l[r.identifier][t].push(g),r.raw[t][c]},set(a,c,h){return a[c]=h,r.set_data(t,JSON.stringify(a)),l[r.identifier][t].forEach(u=>u()),!0}});e(o)})})}reactive_with_default(t,r){const s=this;return s.set_data(t,JSON.stringify(r)),s.raw[t]=r,l[s.identifier][t]=[],new Proxy(r,{get(e,o){return v&&l[s.identifier][t].push(g),e[o]},set(e,o,a){return e[o]=a,s.set_data(t,JSON.stringify(e)),l[s.identifier][t].forEach(c=>c()),!0}})}}let v=!1,g=()=>{},l={};function y(n){v=!0,g=n,n(),v=!1}const _=new S("localhost:2341");await _.connect();const E=await _.reactive("guess"),m=await _.reactive("answer"),b=await _.reactive("interactions"),N=document.querySelector("#input");N.addEventListener("input",()=>{E.guess=N.value});const q=document.querySelector("#close");q.addEventListener("click",()=>{b.close=!0});y(()=>{const n=document.querySelector("#result");console.log(m.answer),n.innerHTML=m.answer});
